// Generated by CoffeeScript 1.6.3
(function() {
  var root;

  root = typeof exports !== "undefined" && exports !== null ? exports : this;

  root.EBayPoller = {};

  root.EBayPoller.callback = function(ebayResults) {
    var datetime, html, item, itemPresent, items, resultEl, _i, _len;
    items = ebayResults.findItemsByKeywordsResponse[0].searchResult[0].item || [];
    html = [];
    itemPresent = false;
    datetime = (new Date()).toUTCString();
    html.push("Results for \"" + window.query + "\" retrieved on " + datetime);
    html.push('<table width="100%" border="0" cellspacing="0" cellpadding="3"><tbody>');
    for (_i = 0, _len = items.length; _i < _len; _i++) {
      item = items[_i];
      if ((item.title != null) && (item.viewItemURL != null)) {
        itemPresent = true;
        html.push('<tr><td>' + '<img src="' + item.galleryURL + '" border="0">' + '</td>' + '<td><a href="' + item.viewItemURL + '" target="_blank">' + item.title + '</a></td></tr>');
      }
    }
    html.push('</tbody></table><hr>');
    resultEl = document.getElementById('results');
    resultEl.innerHTML = html.join('') + resultEl.innerHTML;
    return EBayPoller.updateItemPresenceStatus(itemPresent);
  };

  root.EBayPoller.updateItemPresenceStatus = function(itemPresent) {
    if (itemPresent) {
      EBayPoller.makeANoise();
      return EBayPoller.changeBackGroundColour(true);
    } else {
      return EBayPoller.changeBackGroundColour(false);
    }
  };

  root.EBayPoller.makeANoise = function() {
    var audioElement;
    audioElement = document.getElementById('noise');
    return audioElement.play();
  };

  root.EBayPoller.changeBackGroundColour = function(success) {
    var cssClass;
    if (success) {
      cssClass = "itemPresent";
    } else {
      cssClass = "itemAbsent";
    }
    return root.document.getElementsByTagName('body')[0].className = cssClass;
  };

}).call(this);
