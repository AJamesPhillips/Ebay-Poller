// Generated by CoffeeScript 1.3.3
(function() {
  var buildFilterURL, resultsFilter, root, scriptElement, url;

  root = typeof exports !== "undefined" && exports !== null ? exports : this;

  root._cb_findItemsByKeywords = function(ebayResults) {
    var html, item, items, _i, _len;
    items = ebayResults.findItemsByKeywordsResponse[0].searchResult[0].item || [];
    html = [];
    html.push('<table width="100%" border="0" cellspacing="0" cellpadding="3"><tbody>');
    for (_i = 0, _len = items.length; _i < _len; _i++) {
      item = items[_i];
      if ((item.title != null) && (item.viewItemURL != null)) {
        html.push('<tr><td>' + '<img src="' + item.galleryURL + '" border="0">' + '</td>' + '<td><a href="' + item.viewItemURL + '" target="_blank">' + item.title + '</a></td></tr>');
      }
    }
    html.push('</tbody></table>');
    return document.getElementById("results").innerHTML = html.join("");
  };

  url = "http://svcs.ebay.com/services/search/FindingService/v1?OPERATION-NAME=findItemsByKeywords&SERVICE-VERSION=1.0.0&SECURITY-APPNAME=Jf8f7d060-1456-4fa9-bfc6-ec5d2e1c822&GLOBAL-ID=EBAY-US&RESPONSE-DATA-FORMAT=JSON&callback=_cb_findItemsByKeywords&REST-PAYLOAD&keywords=harry%20potter&paginationInput.entriesPerPage=3";

  resultsFilter = [
    {
      name: "MaxPrice",
      value: "25",
      paramName: "Currency",
      paramValue: "U"
    }, {
      name: "FreeShippingOnly",
      value: "true",
      paramName: "",
      paramValue: ""
    }, {
      name: "ListingType",
      value: ["AuctionWithBIN", "FixedPrice", "StoreInventory"],
      paramName: "",
      paramValue: ""
    }
  ];

  /* 
   * Generates an indexed URL snippet from the array of item filters
   * 
   * @param resultsFilter {array}  item filters to apply to the search results
   * 
   * @param urlFilter {string}  string, of indexed filters, to append to search request URL
  */


  buildFilterURL = function(resultsFilter) {
    var filterItem, index, r, urlFilter, value, _i, _j, _k, _len, _len1, _len2, _ref;
    urlFilter = "";
    for (_i = 0, _len = resultsFilter.length; _i < _len; _i++) {
      filterItem = resultsFilter[_i];
      for (_j = 0, _len1 = filterItem.length; _j < _len1; _j++) {
        index = filterItem[_j];
        if (filterItem[index] !== "") {
          if (filterItem[index] instanceof Array) {
            _ref = itemFilter[index];
            for (r = _k = 0, _len2 = _ref.length; _k < _len2; r = ++_k) {
              value = _ref[r];
              urlFilter += "&itemfilter\(" + i + "\)." + index + "\(" + r + "\)=" + value;
            }
          } else {
            urlFilter += "&itemfilter\(" + i + "\)." + index + "=" + itemFilter[index];
          }
        }
      }
    }
    return urlFilter;
  };

  url += buildFilterURL(resultsFilter);

  scriptElement = document.createElement('script');

  scriptElement.src = url;

  document.body.appendChild(scriptElement);

}).call(this);
